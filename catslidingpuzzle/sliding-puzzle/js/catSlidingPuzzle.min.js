"use strict";function buildLabel(){for(var e,t,n=[0,1,2,3,4,5,6,7,8],a=n.length-1,i="";a>=0;){var r=(e=0,t=a,Math.floor(Math.random()*(t-e+1))+e);i+=n.splice(r,1).toString(),a--}return i}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var PriorityQueue=function(){function e(){_classCallCheck(this,e),this.data=[],this.comparator=function(e,t){return e-t}}return _createClass(e,[{key:"binarySearch",value:function(e){var t=void 0,n=void 0,a=void 0;for(t=0,a=this.data.length-1;t<=a;)n=t+a>>>1,this.comparator(this.data[n][1],e)<=0?t=n+1:a=n-1;return t}},{key:"dequeue",value:function(){return this.isEmpty()?"Underflow":this.data.shift()}},{key:"enqueue",value:function(e,t){var n=this.binarySearch(t);this.data.splice(n,0,[e,t])}},{key:"isEmpty",value:function(){return 0===this.data.length}}]),e}();_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Astar=function(){function e(){_classCallCheck(this,e),this.tileCoord=new Map([[0,[0,0]],[1,[0,1]],[2,[0,2]],[3,[1,0]],[4,[1,1]],[5,[1,2]],[6,[2,0]],[7,[2,1]],[8,[2,2]]])}return _createClass(e,[{key:"manhattenDistance",value:function(e){for(var t=e.label,n=void 0,a=void 0,i=0,r=0,s=t.length;r<s;r++)"0"!==(n=t[r])&&(a=parseInt(n)-1,i+=Math.abs(this.tileCoord.get(r)[0]-this.tileCoord.get(a)[0])+Math.abs(this.tileCoord.get(r)[1]-this.tileCoord.get(a)[1]));return i}}]),e}();_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Puzzle=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(_classCallCheck(this,e),this.goal="123456780",this.shifts=new Map([[0,[1,3]],[1,[0,2,4]],[2,[1,5]],[3,[0,4,6]],[4,[1,3,5,7]],[5,[2,4,8]],[6,[3,7]],[7,[4,6,8]],[8,[5,7]]]),this.pos=new Map([[0,[0,0]],[1,[111,0]],[2,[222,0]],[3,[0,115]],[4,[111,115]],[5,[222,115]],[6,[0,230]],[7,[111,230]],[8,[222,230]]]),t){this.label=t;for(var n=0;n<t.length;n++)"0"===t[n]&&(this.spot=n)}}return _createClass(e,[{key:"transitionSolution",value:function(t){for(var n=this.label,a=this.spot,i=this.label[t],r="",s=0;s<9;s++)r+=s===a?i:s===t?"0":n[s];return new e(r)}},{key:"solution",value:function(){var e=(new Date).getTime(),t=null,n=new PriorityQueue,a=new Astar,i=void 0,r=void 0,s=void 0,o=void 0;if(this.label){var l=[this];for(n.enqueue(l,1);!(n.isEmpty()||(new Date).getTime()-e>3e3);)if((r=(i=n.dequeue()[0])[i.length-1]).label===r.goal&&(null===t||i.length<t.length)&&(t=i),null===t||i.length+1<t.length){var u=!0,c=!1,h=void 0;try{for(var f,d=this.shifts.get(r.spot)[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var v=f.value;if(s=r.transitionSolution(v),this.notInPath(s,i)){o=i.concat(s);var b=a.manhattenDistance(s);n.enqueue(o,b)}}}catch(e){c=!0,h=e}finally{try{!u&&d.return&&d.return()}finally{if(c)throw h}}}return null===t?this.solutionFallback(n,a):t}}},{key:"solutionFallback",value:function(e,t){for(var n=void 0,a=void 0,i=void 0,r=void 0;!e.isEmpty();){if((a=(n=e.dequeue()[0])[n.length-1]).label===a.goal)return n;var s=!0,o=!1,l=void 0;try{for(var u,c=this.shifts.get(a.spot)[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var h=u.value;if(i=a.transitionSolution(h),this.notInPath(i,n)){r=n.concat(i);var f=t.manhattenDistance(i);e.enqueue(r,f)}}}catch(e){o=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw l}}}return null}},{key:"notInPath",value:function(e,t){var n=!0,a=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var o=r.value;if(e.label===o.label)return!1}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return!0}},{key:"solvable",value:function(e){for(var t=0,n=e.length,a=0;a<n;a++)for(var i=a+1;i<n;i++)parseInt(e[a])&&parseInt(e[i])&&parseInt(e[a])>parseInt(e[i])&&t++;return t%2==0}}]),e}(),PuzzleCat=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.init(),e}return _inherits(t,Puzzle),_createClass(t,[{key:"init",value:function(){this.cats=["barns","chedda"],this.removeHandlers=[],this.thumbnails=document.querySelectorAll(".thumbnail"),this.background=document.querySelectorAll(".background"),this.mainCat=document.querySelectorAll(".main-cat.hide"),this.congratulate=document.querySelectorAll(".congratulate.hide"),this.mainBarns=this.mainCat[0],this.mainChedda=this.mainCat[1],this.shuffle=document.querySelectorAll(".shuffle"),this.solve=document.querySelectorAll(".solve"),this.progressRing=document.querySelector("#progress-ring"),this.handlers()}},{key:"handlers",value:function(){var e=this;this.thumbnails.forEach(function(t,n){t.addEventListener("click",function(){e.thumbnailHandler(n)})}),this.shuffle.forEach(function(t){t.addEventListener("click",function(){e.shufflePuzzle()})}),this.solve.forEach(function(t){t.addEventListener("click",function(){e.label&&e.label!==e.goal&&(t.disabled=!0,e.shuffle.forEach(function(e){e.disabled=!0}),e.promiseInitAnimate().then(function(){e.promiseAnimateSolution().then(function(){e.progressRing.classList.add("hide"),e.shuffle.forEach(function(e){e.disabled=!1}),t.disabled=!1})}))})})}},{key:"thumbnailHandler",value:function(e){this.removeTileHandler(),this.tiles&&this.tiles.stop(!0,!0),this.cat=this.cats[e],this.hideTiles(),"barns"===this.cats[e]?(this.background[e].style.backgroundImage="url(images/barns.jpg)",this.mainBarns.className="main-cat",this.mainChedda.className="main-cat hide",this.congratulate[e].className="congratulate hide"):"chedda"===this.cats[e]&&(this.background[e].style.backgroundImage="url(images/chedda.jpg)",this.mainBarns.className="main-cat hide",this.mainChedda.className="main-cat",this.congratulate[e].className="congratulate hide"),this.label=null}},{key:"shufflePuzzle",value:function(){var e=this;this.removeTileHandler(),this.removeHandlers=[],this.tileSelector(),$.each(this.tiles,function(t,n){e.removeHandlers.push(e.listener(n,"click",e.moveTileHandler(n)))}),this.tiles.stop(!0,!0);var t=void 0;do{t=buildLabel()}while(!this.solvable(t));this.label=t,$.each(this.tiles,function(e,t){t.removeAttribute("style")});for(var n=0,a=this.label.length;n<a;n++)if("0"===this.label[n])this.spot=n;else{var i=parseInt(this.label[n])-1;this.tiles[i].className="container-tile tile pos"+n,this.tiles[i].boardPos=n}}},{key:"tileSelector",value:function(){var e=this;this.cats.forEach(function(t,n){"barns"===e.cat?(e.tiles=$(".background.background-barns .container-tile"),e.background[n].style.backgroundImage="url(images/barns_transparent.jpg)",e.congratulate[n].className="congratulate hide"):"chedda"===e.cat&&(e.tiles=$(".background.background-chedda .container-tile"),e.background[n].style.backgroundImage="url(images/chedda_transparent.jpg)",e.congratulate[n].className="congratulate hide")})}},{key:"hideTiles",value:function(){"barns"===this.cat?this.tiles=$(".background.background-barns .container-tile"):"chedda"===this.cat&&(this.tiles=$(".background.background-chedda .container-tile")),$.each(this.tiles,function(e,t){t.classList.add("hide")})}},{key:"listener",value:function(e,t,n){return e.addEventListener(t,n),function(){e.removeEventListener(t,n)}}},{key:"removeTileHandler",value:function(){this.removeHandlers.forEach(function(e){e()})}},{key:"moveTileHandler",value:function(e){var t=this;return function(){t.playerMove(e)}}},{key:"playerMove",value:function(e){if(this.shifts.get(this.spot).includes(e.boardPos)){var t=this.spot;this.transition(e.boardPos),e.className="tile container-tile animate pos"+this.spot,this.spot=e.boardPos,e.boardPos=t,this.label===this.goal&&("barns"===this.cat?this.congratulate[0].classList.remove("hide"):this.congratulate[1].classList.remove("hide"),this.removeTileHandler())}}},{key:"transition",value:function(e){for(var t=this.spot,n=this.label[e],a="",i=0;i<9;i++)a+=i==t?n:i==e?"0":this.label[i];this.label=a}},{key:"solutionAnimation",value:function(e){$.each(this.tiles,function(e,t){t.classList.remove("animate")});for(var t=1,n=e.length;t<n;t++)for(var a=e[t].label,i=0,r=a.length;i<r;i++)if("0"===a[i])this.spot=i;else{var s=parseInt(a[i])-1;$(this.tiles[s]).animate({left:this.pos.get(i)[0]+"px"},"fast").animate({top:this.pos.get(i)[1]+"px"},"fast")}this.label=this.goal}},{key:"promiseInitAnimate",value:function(){var e=this;return new Promise(function(t){e.progressRing.classList.remove("hide"),e.removeTileHandler(),window.setTimeout(function(){t()},300)})}},{key:"promiseAnimateSolution",value:function(){var e=this;return new Promise(function(t){var n=e.solution();e.solutionAnimation(n),window.setTimeout(function(){t()})})}}]),t}();new PuzzleCat;